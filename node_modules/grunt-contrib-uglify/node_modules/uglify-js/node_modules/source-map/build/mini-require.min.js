function define(moduleName,deps,payload){if(typeof moduleName!="string"){throw new TypeError("Expected string, got: "+moduleName)}if(arguments.length==2){payload=deps}if(moduleName in define.modules){throw new Error("Module already defined: "+moduleName)}define.modules[moduleName]=payload}define.modules={};function Domain(){this.modules={};this._currentModule=null}(function(){Domain.prototype.require=function(deps,callback){if(Array.isArray(deps)){var params=deps.map(function(dep){return this.lookup(dep)},this);if(callback){callback.apply(null,params)}return undefined}else{return this.lookup(deps)}};function normalize(path){var bits=path.split("/");var i=1;while(i<bits.length){if(bits[i]===".."){bits.splice(i-1,1)}else if(bits[i]==="."){bits.splice(i,1)}else{i++}}return bits.join("/")}function join(a,b){a=a.trim();b=b.trim();if(/^\//.test(b)){return b}else{return a.replace(/\/*$/,"/")+b}}function dirname(path){var bits=path.split("/");bits.pop();return bits.join("/")}Domain.prototype.lookup=function(moduleName){if(/^\./.test(moduleName)){moduleName=normalize(join(dirname(this._currentModule),moduleName))}if(moduleName in this.modules){var module=this.modules[moduleName];return module}if(!(moduleName in define.modules)){throw new Error("Module not defined: "+moduleName)}var module=define.modules[moduleName];if(typeof module=="function"){var exports={};var previousModule=this._currentModule;this._currentModule=moduleName;module(this.require.bind(this),exports,{id:moduleName,uri:""});this._currentModule=previousModule;module=exports}this.modules[moduleName]=module;return module}})();define.Domain=Domain;define.globalDomain=new Domain;var require=define.globalDomain.require.bind(define.globalDomain);