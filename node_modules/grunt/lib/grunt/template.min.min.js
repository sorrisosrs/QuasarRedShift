"use strict";var grunt=require("../grunt");var template=module.exports={};template.date=require("dateformat");template.today=function(format){return template.date(new Date,format)};var allDelimiters={};template.addDelimiters=function(name,opener,closer){var delimiters=allDelimiters[name]={};delimiters.opener=opener;delimiters.closer=closer;var a=delimiters.opener.replace(/(.)/g,"\\$1");var b="([\\s\\S]+?)"+delimiters.closer.replace(/(.)/g,"\\$1");delimiters.lodash={evaluate:new RegExp(a+b,"g"),interpolate:new RegExp(a+"="+b,"g"),escape:new RegExp(a+"-"+b,"g")}};template.addDelimiters("config","<%","%>");template.setDelimiters=function(name){var delimiters=allDelimiters[name in allDelimiters?name:"config"];grunt.util._.templateSettings=delimiters.lodash;return delimiters};template.process=function(tmpl,options){if(!options){options={}}var delimiters=template.setDelimiters(options.delimiters);var data=Object.create(options.data||grunt.config.data||{});if(!("grunt"in data)){data.grunt=grunt}var last=tmpl;try{while(tmpl.indexOf(delimiters.opener)>=0){tmpl=grunt.util._.template(tmpl,data);if(tmpl===last){break}last=tmpl}}catch(e){if(String(e)==="SyntaxError: Unexpected token ILLEGAL"&&/\n|\r/.test(tmpl)){grunt.log.errorlns("A special character was detected in this template. "+"Inside template tags, the \\n and \\r special characters must be "+"escaped as \\\\n and \\\\r. (grunt 0.4.0+)")}e.message="An error occurred while processing a template ("+e.message+").";grunt.warn(e,grunt.fail.code.TEMPLATE_ERROR)}return grunt.util.normalizelf(tmpl)};