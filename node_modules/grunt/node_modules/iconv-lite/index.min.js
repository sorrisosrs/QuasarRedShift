var RE_SPACEDASH=/[- ]/g;var iconv=module.exports={toEncoding:function(str,encoding){return iconv.getCodec(encoding).toEncoding(str)},fromEncoding:function(buf,encoding){return iconv.getCodec(encoding).fromEncoding(buf)},encodingExists:function(enc){loadEncodings();enc=enc.replace(RE_SPACEDASH,"").toLowerCase();return iconv.encodings[enc]!==undefined},defaultCharUnicode:"ï¿½",defaultCharSingleByte:"?",encodingsLoaded:false,getCodec:function(encoding){loadEncodings();var enc=encoding||"utf8";var codecOptions=undefined;while(1){if(getType(enc)==="String")enc=enc.replace(RE_SPACEDASH,"").toLowerCase();var codec=iconv.encodings[enc];var type=getType(codec);if(type==="String"){codecOptions={originalEncoding:enc};enc=codec}else if(type==="Object"&&codec.type!=undefined){codecOptions=codec;enc=codec.type}else if(type==="Function")return codec(codecOptions);else throw new Error("Encoding not recognized: '"+encoding+"' (searched as: '"+enc+"')")}},encodings:{internal:function(options){return{toEncoding:toInternalEncoding,fromEncoding:fromInternalEncoding,options:options}},utf8:"internal",ucs2:"internal",binary:"internal",ascii:"internal",base64:"internal",singlebyte:function(options){if(!options.charsBuf){if(!options.chars||options.chars.length!==128&&options.chars.length!==256)throw new Error("Encoding '"+options.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(options.chars.length===128)options.chars=asciiString+options.chars;options.charsBuf=new Buffer(options.chars,"ucs2")}if(!options.revCharsBuf){options.revCharsBuf=new Buffer(65536);var defChar=iconv.defaultCharSingleByte.charCodeAt(0);for(var i=0;i<options.revCharsBuf.length;i++)options.revCharsBuf[i]=defChar;for(var i=0;i<options.chars.length;i++)options.revCharsBuf[options.chars.charCodeAt(i)]=i}return{toEncoding:toSingleByteEncoding,fromEncoding:fromSingleByteEncoding,options:options}},table:function(options){if(!options.table){throw new Error("Encoding '"+options.type+"' has incorect 'table' option")}if(!options.revCharsTable){var revCharsTable=options.revCharsTable={};for(var i=0;i<=65535;i++){revCharsTable[i]=0}var table=options.table;for(var key in table){revCharsTable[table[key]]=+key}}return{toEncoding:toTableEncoding,fromEncoding:fromTableEncoding,options:options}}}};function toInternalEncoding(str){return new Buffer(ensureString(str),this.options.originalEncoding)}function fromInternalEncoding(buf){return ensureBuffer(buf).toString(this.options.originalEncoding)}function toTableEncoding(str){str=ensureString(str);var strLen=str.length;var revCharsTable=this.options.revCharsTable;var newBuf=new Buffer(strLen*2),gbkcode,unicode,defaultChar=revCharsTable[iconv.defaultCharUnicode.charCodeAt(0)];for(var i=0,j=0;i<strLen;i++){unicode=str.charCodeAt(i);if(unicode>>7){gbkcode=revCharsTable[unicode]||defaultChar;newBuf[j++]=gbkcode>>8;newBuf[j++]=gbkcode&255}else{newBuf[j++]=unicode}}return newBuf.slice(0,j)}function fromTableEncoding(buf){buf=ensureBuffer(buf);var bufLen=buf.length;var table=this.options.table;var newBuf=new Buffer(bufLen*2),unicode,gbkcode,defaultChar=iconv.defaultCharUnicode.charCodeAt(0);for(var i=0,j=0;i<bufLen;i++,j+=2){gbkcode=buf[i];if(gbkcode&128){gbkcode=(gbkcode<<8)+buf[++i];unicode=table[gbkcode]||defaultChar}else{unicode=gbkcode}newBuf[j]=unicode&255;newBuf[j+1]=unicode>>8}return newBuf.slice(0,j).toString("ucs2")}function toSingleByteEncoding(str){str=ensureString(str);var buf=new Buffer(str.length);var revCharsBuf=this.options.revCharsBuf;for(var i=0;i<str.length;i++)buf[i]=revCharsBuf[str.charCodeAt(i)];return buf}function fromSingleByteEncoding(buf){buf=ensureBuffer(buf);var charsBuf=this.options.charsBuf;var newBuf=new Buffer(buf.length*2);var idx1=0,idx2=0;for(var i=0,_len=buf.length;i<_len;i++){idx1=buf[i]*2;idx2=i*2;newBuf[idx2]=charsBuf[idx1];newBuf[idx2+1]=charsBuf[idx1+1]}return newBuf.toString("ucs2")}iconv.encode=iconv.toEncoding;iconv.decode=iconv.fromEncoding;function loadEncodings(){if(!iconv.encodingsLoaded){[require("./encodings/singlebyte"),require("./encodings/gbk"),require("./encodings/big5")].forEach(function(encodings){for(var key in encodings)iconv.encodings[key]=encodings[key]});iconv.encodingsLoaded=true}}var asciiString="\x00\b	\n\f\r"+" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";var ensureBuffer=function(buf){buf=buf||new Buffer(0);return buf instanceof Buffer?buf:new Buffer(""+buf,"binary")};var ensureString=function(str){str=str||"";return str instanceof Buffer?str.toString("utf8"):""+str};var getType=function(obj){return Object.prototype.toString.call(obj).slice(8,-1)};